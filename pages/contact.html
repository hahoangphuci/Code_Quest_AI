<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeQuest - Đặc Trưng</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/contact.css" />
  </head>

  <body>
    <!-- Header giữ nguyên -->
    <header class="site_header">
      <div class="container_header">
        <div class="logo_header">
          <img
            onclick="location.href='/home'"
            src="../assets/image/logo.png"
            alt="Logo"
            class="logo-animate"
          />
          <a href="/home" class="">CodeQuest</a>
        </div>
        <nav class="nav_header">
          <button class="nav_btn" onclick="location.href='/home'">
            Trang Chủ
          </button>
          <button
            id="about-btn"
            class="nav_btn"
            onclick="location.href='/about'"
          >
            Giới Thiệu
          </button>
          <button class="nav_btn" onclick="location.href='/features'">
            Đặc Trưng
          </button>
          <button class="nav_btn" onclick="location.href='/contact'">
            Liên Hệ
          </button>
        </nav>

        <!-- Auth section với dropdown menu -->
        <div class="auth_header">
          <button class="login_btn" onclick="handleAuthRedirect('login')">
            Đăng Nhập
          </button>
          <button class="register_btn" onclick="handleAuthRedirect('register')">
            Đăng Ký
          </button>
        </div>

        <!-- User dropdown menu (ẩn ban đầu) -->
        <div class="user_menu" id="user_menu" style="display: none">
          <div class="user_info_header">
            <div class="user_avatar_small" id="user_avatar_small">U</div>
            <div class="user_details">
              <span class="user_name" id="user_name_header">User</span>
              <span class="user_role">CodeQuest Member</span>
            </div>
            <button class="dropdown_toggle" id="dropdown_toggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>

          <div class="dropdown_menu" id="dropdown_menu">
            <a href="/profile" class="dropdown_item">
              <i class="fas fa-user-edit"></i>
              <span>Cập nhật thông tin</span>
            </a>
            <button class="dropdown_item logout_btn" id="logout_btn">
              <i class="fas fa-sign-out-alt"></i>
              <span>Đăng xuất</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="site_main">
      <!-- Contact Info Cards -->
      <section class="contact_info_section">
        <div class="contact_info_grid">
          <div class="contact_info_card">
            <div class="info_icon_wrapper">
              <i class="fas fa-envelope"></i>
            </div>
            <h3>Email Hỗ Trợ</h3>
            <p class="info_detail">support@codequest.com</p>
            <p class="info_note">Phản hồi trong 24 giờ</p>
          </div>

          <div class="contact_info_card">
            <div class="info_icon_wrapper">
              <i class="fas fa-phone-alt"></i>
            </div>
            <h3>Hotline</h3>
            <p class="info_detail">+84 123 456 789</p>
            <p class="info_note">T2-CN: 8:00 - 22:00</p>
          </div>

          <div class="contact_info_card">
            <div class="info_icon_wrapper">
              <i class="fas fa-map-marker-alt"></i>
            </div>
            <h3>Địa Chỉ</h3>
            <p class="info_detail">Cần Thơ, Việt Nam</p>
            <p class="info_note">Văn phòng chính</p>
          </div>
        </div>
      </section>

      <!-- Main Contact Form -->
      <section class="contact_form_section">
        <div class="form_container">
          <div class="form_content">
            <div class="form_left">
              <h2>Gửi Tin Nhắn Cho Chúng Tôi</h2>
              <p class="form_description">
                Bạn có câu hỏi về CodeQuest? Điền form bên cạnh và chúng tôi sẽ
                liên hệ lại trong thời gian sớm nhất.
              </p>

              <div class="contact_features">
                <div class="feature_item">
                  <i class="fas fa-check-circle"></i>
                  <span>Hỗ trợ miễn phí 24/7</span>
                </div>
                <div class="feature_item">
                  <i class="fas fa-check-circle"></i>
                  <span>Phản hồi nhanh chóng</span>
                </div>
                <div class="feature_item">
                  <i class="fas fa-check-circle"></i>
                  <span>Tư vấn chuyên nghiệp</span>
                </div>
              </div>

              <div class="social_section">
                <h4>Kết nối với chúng tôi</h4>
                <div class="social_links">
                  <a href="#" class="social_link facebook">
                    <i class="fab fa-facebook-f"></i>
                  </a>
                  <a href="#" class="social_link twitter">
                    <i class="fab fa-twitter"></i>
                  </a>
                  <a href="#" class="social_link github">
                    <i class="fab fa-github"></i>
                  </a>
                  <a href="#" class="social_link discord">
                    <i class="fab fa-discord"></i>
                  </a>
                </div>
              </div>
            </div>

            <div class="form_right">
              <form class="contact_form" id="contactForm">
                <div class="form_row">
                  <div class="form_group">
                    <label>Họ và Tên</label>
                    <input type="text" placeholder="Nguyễn Văn A" required />
                  </div>
                </div>

                <div class="form_row">
                  <div class="form_group">
                    <label>Email</label>
                    <input
                      type="email"
                      placeholder="example@email.com"
                      required
                    />
                  </div>
                </div>

                <div class="form_row">
                  <div class="form_group">
                    <label>Số Điện Thoại</label>
                    <input type="tel" placeholder="+84 123 456 789" />
                  </div>
                </div>

                <div class="form_row">
                  <div class="form_group">
                    <label>Chủ Đề</label>
                    <select required>
                      <option value="">Chọn chủ đề</option>
                      <option value="support">Hỗ trợ kỹ thuật</option>
                      <option value="account">Tài khoản</option>
                      <option value="billing">Thanh toán</option>
                      <option value="feature">Tính năng mới</option>
                      <option value="partnership">Hợp tác</option>
                      <option value="other">Khác</option>
                    </select>
                  </div>
                </div>

                <div class="form_row">
                  <div class="form_group">
                    <label>Nội Dung</label>
                    <textarea
                      rows="5"
                      placeholder="Nhập nội dung tin nhắn của bạn..."
                      required
                    ></textarea>
                  </div>
                </div>

                <button type="submit" class="submit_btn">
                  <span>Gửi Tin Nhắn</span>
                  <i class="fas fa-paper-plane"></i>
                </button>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ Section -->
      <section class="faq_section">
        <div class="faq_container">
          <div class="faq_header">
            <h2>Câu Hỏi Thường Gặp</h2>
            <p>Tìm câu trả lời nhanh chóng cho các câu hỏi phổ biến</p>
          </div>

          <div class="faq_grid">
            <div class="faq_item">
              <div class="faq_question">
                <i class="fas fa-question-circle"></i>
                <h3>Làm thế nào để bắt đầu học trên CodeQuest?</h3>
              </div>
              <p>
                Chỉ cần đăng ký tài khoản miễn phí và chọn khóa học phù hợp với
                trình độ của bạn. Hệ thống sẽ tự động gợi ý lộ trình học tập.
              </p>
            </div>

            <div class="faq_item">
              <div class="faq_question">
                <i class="fas fa-question-circle"></i>
                <h3>CodeQuest có miễn phí không?</h3>
              </div>
              <p>
                CodeQuest có gói miễn phí với đầy đủ tính năng cơ bản. Gói
                Premium có thêm nhiều tính năng nâng cao và nội dung độc quyền.
              </p>
            </div>

            <div class="faq_item">
              <div class="faq_question">
                <i class="fas fa-question-circle"></i>
                <h3>Tôi có thể học những ngôn ngữ nào?</h3>
              </div>
              <p>
                CodeQuest hỗ trợ Python, JavaScript, Java, C++, Rust và nhiều
                ngôn ngữ khác với nội dung được cập nhật thường xuyên.
              </p>
            </div>

            <div class="faq_item">
              <div class="faq_question">
                <i class="fas fa-question-circle"></i>
                <h3>Có chứng chỉ sau khi hoàn thành không?</h3>
              </div>
              <p>
                Có, bạn sẽ nhận được chứng chỉ khi hoàn thành khóa học. Chứng
                chỉ có thể chia sẻ trên LinkedIn và CV.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- CTA Section -->
      <section class="contact_cta">
        <div class="cta_content">
          <h2>Bắt Đầu Hành Trình Học Lập Trình</h2>
          <p>
            Tham gia CodeQuest ngay hôm nay và trải nghiệm phương pháp học lập
            trình hiện đại nhất
          </p>
          <button class="cta_button" onclick="handleGetStarted()">
            Thử Ngay Miễn Phí
          </button>
        </div>
      </section>
    </main>
    <!-- Footer Section -->
    <footer class="site-footer">
      <div class="footer-container">
        <!-- Thông tin liên hệ -->
        <div class="footer-contact">
          <p><strong>CodeQuest</strong></p>
          <p>Email: support@codequest.com</p>
          <p>Hotline: +84 123 456 789</p>
          <div class="footer-socials">
            <a href="#"
              ><i
                class="fab fa-facebook"
                style="font-size: 20px; color: #4267b2"
              ></i
            ></a>
            <a href="#"
              ><i class="fab fa-github" style="font-size: 20px; color: #333"></i
            ></a>
            <a href="#"
              ><i
                class="fab fa-twitter"
                style="font-size: 20px; color: #1da1f2"
              ></i
            ></a>
          </div>
        </div>

        <!-- Liên kết nhanh -->
        <div class="footer-links">
          <div class="footer-column">
            <h4>Sản phẩm</h4>
            <ul>
              <li><a href="home.html">Trang Chủ</a></li>
              <li><a href="about.html">Giới Thiệu</a></li>
              <li><a href="features.html">Đặc Trưng</a></li>
              <li><a href="contact.html">Liên Hệ</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <h4>Công ty</h4>
            <ul>
              <li><a href="about.html">Về chúng tôi</a></li>
              <li><a href="careers.html">Cơ hội nghề nghiệp</a></li>
              <li><a href="clients.html">Khách hàng</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Pháp lý</h4>
            <ul>
              <li><a href="/legal">Pháp lý</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Kiểm tra session và cập nhật header
      async function checkSessionAndUpdateHeader() {
        try {
          const response = await fetch("/api/auth/check-session");
          const data = await response.json();

          if (data.success && data.authenticated) {
            // User đã đăng nhập, hiển thị dropdown menu
            document.querySelector(".auth_header").style.display = "none";
            document.getElementById("user_menu").style.display = "flex";

            // Cập nhật thông tin user
            document.getElementById("user_name_header").textContent =
              data.user.full_name || "User";
            const avatar = document.getElementById("user_avatar_small");
            avatar.textContent = data.user.full_name
              ? data.user.full_name.charAt(0).toUpperCase()
              : "U";

            setupDropdownEvents();
          } else {
            // User chưa đăng nhập, hiển thị login/register buttons
            document.querySelector(".auth_header").style.display = "flex";
            document.getElementById("user_menu").style.display = "none";
          }
        } catch (error) {
          console.error("Error checking session:", error);
          // Mặc định hiển thị login/register
          document.querySelector(".auth_header").style.display = "flex";
          document.getElementById("user_menu").style.display = "none";
        }
      }

      function setupDropdownEvents() {
        const dropdownToggle = document.getElementById("dropdown_toggle");
        const dropdownMenu = document.getElementById("dropdown_menu");
        const logoutBtn = document.getElementById("logout_btn");

        // Toggle dropdown
        dropdownToggle.addEventListener("click", function (e) {
          e.stopPropagation();
          dropdownMenu.classList.toggle("show");
          dropdownToggle.classList.toggle("active");
        });

        // Đóng dropdown khi click ra ngoài
        document.addEventListener("click", function () {
          dropdownMenu.classList.remove("show");
          dropdownToggle.classList.remove("active");
        });

        // Xử lý logout
        logoutBtn.addEventListener("click", async function () {
          try {
            const response = await fetch("/api/auth/logout", {
              method: "POST",
            });

            if (response.ok) {
              window.location.href = "/home";
            }
          } catch (error) {
            console.error("Logout error:", error);
          }
        });
      }

      // Set active navigation button
      function setActiveNavButton() {
        const currentPage = window.location.pathname;
        const navButtons = document.querySelectorAll(".nav_btn");

        navButtons.forEach((btn) => {
          btn.classList.remove("active");

          // Check which page we're on and set active class
          if (
            currentPage.includes("/home") &&
            btn.textContent.trim() === "Trang Chủ"
          ) {
            btn.classList.add("active");
          } else if (
            currentPage.includes("/about") &&
            btn.textContent.trim() === "Giới Thiệu"
          ) {
            btn.classList.add("active");
          } else if (
            currentPage.includes("/features") &&
            btn.textContent.trim() === "Đặc Trưng"
          ) {
            btn.classList.add("active");
          } else if (
            currentPage.includes("/contact") &&
            btn.textContent.trim() === "Liên Hệ"
          ) {
            btn.classList.add("active");
          }
        });
      }

      // Xử lý nút "Thử Ngay Miễn Phí"
      async function handleGetStarted() {
        try {
          const response = await fetch("/api/auth/check-session");
          const data = await response.json();

          if (data.success && data.authenticated) {
            // Đã đăng nhập, chuyển thẳng đến dashboard
            window.location.href = "/dashboard";
          } else {
            // Chưa đăng nhập, chuyển đến trang auth
            window.location.href = "/auth";
          }
        } catch (error) {
          console.error("Error checking session:", error);
          // Nếu có lỗi, mặc định chuyển đến auth
          window.location.href = "/auth";
        }
      }

      // Chạy khi trang load
      document.addEventListener("DOMContentLoaded", function () {
        checkSessionAndUpdateHeader();
        setActiveNavButton();
      });
    </script>
  </body>
</html>
